package edu.hubanato.forms;

import edu.hubanato.controlers.AmortizationCalc;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.PrintJob;
import java.awt.Toolkit;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.print.PageFormat;
import java.awt.print.Printable;
import java.awt.print.PrinterException;
import java.awt.print.PrinterJob;
import java.util.Properties;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JTable;
import org.jfree.chart.ChartFactory;
import org.jfree.chart.ChartPanel;
import org.jfree.chart.JFreeChart;
import org.jfree.chart.plot.PlotOrientation;
import org.jfree.data.category.DefaultCategoryDataset;
import org.jfree.data.general.DefaultPieDataset;

/**
 *
 * @author Tony
 */
public class AmortizationScheduleForm extends javax.swing.JFrame{

    private AmortizationCalc am;
    private DefaultCategoryDataset datasetLineChartAmount, datasetBarChartGlobal; 
    private DefaultPieDataset datasetPieChartGlobal = new DefaultPieDataset( );
    
    public AmortizationScheduleForm() {
        initComponents();
        datasetLineChartAmount = new DefaultCategoryDataset();
        datasetBarChartGlobal = new DefaultCategoryDataset();
        datasetPieChartGlobal = new DefaultPieDataset();
        //am = new AmortizationCalc(this);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane3 = new javax.swing.JScrollPane();
        amortizationTable = new javax.swing.JTable();
        printButton = new javax.swing.JButton();
        labelAmount = new javax.swing.JLabel();
        labelDuration = new javax.swing.JLabel();
        labelRate = new javax.swing.JLabel();
        labelInsurance = new javax.swing.JLabel();
        buttonGraph = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setPreferredSize(new java.awt.Dimension(563, 450));

        amortizationTable.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mois", "Capital amorti", "Intérêts", "Capital restant", "Mensualité", "Assurance", "Total"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class
            };
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        jScrollPane3.setViewportView(amortizationTable);

        printButton.setText("Imprimer");
        printButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                printButtonActionPerformed(evt);
            }
        });

        labelAmount.setText("Montant de l'emprunt: ");

        labelDuration.setText("Durée du prêt: ");

        labelRate.setText("Taux annuel: ");

        labelInsurance.setText("Taux d'assurance: ");

        buttonGraph.setText("Graphe");
        buttonGraph.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buttonGraphActionPerformed(evt);
            }
        });

        jLabel1.setText("Total mensualités hors assurance:  ");

        jLabel2.setText("Total intérêts: ");

        jLabel3.setText("Total assurance: ");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 551, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(labelAmount)
                    .addComponent(labelDuration)
                    .addComponent(labelRate)
                    .addComponent(labelInsurance)
                    .addComponent(jLabel1)
                    .addComponent(jLabel2)
                    .addComponent(jLabel3))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addGroup(layout.createSequentialGroup()
                .addComponent(printButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(buttonGraph)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(labelAmount)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(labelDuration)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(labelRate)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(labelInsurance)
                .addGap(18, 18, 18)
                .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 212, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(printButton)
                    .addComponent(buttonGraph))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void printButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_printButtonActionPerformed

        try {
            /* print the table */
            boolean complete = this.amortizationTable.print();

            /* if printing completes */
            if (complete) {
                /* show a success message */
                JOptionPane.showMessageDialog(this,
                                              "Impression envoyé",
                                              "Information",
                                              JOptionPane.INFORMATION_MESSAGE);
            } else {
                /* show a message indicating that printing was cancelled */
                JOptionPane.showMessageDialog(this,
                                              "Impression annulée",
                                              "Information",
                                              JOptionPane.INFORMATION_MESSAGE);
            }
        } catch (PrinterException pe) {
            /* Printing failed, report to the user */
            JOptionPane.showMessageDialog(this,
                                          "Impression échouée: " + pe.getMessage(),
                                          "Information",
                                          JOptionPane.ERROR_MESSAGE);
        }
    }//GEN-LAST:event_printButtonActionPerformed

    private void buttonGraphActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buttonGraphActionPerformed
        JFrame graphFrame = new JFrame();
        graphFrame.setTitle("Graph");
        graphFrame.setSize(400, 300);
        graphFrame.setLocationRelativeTo(null);               
 
        //Instanciation d'un objet JPanel
        JPanel pan = new JPanel();   
        pan.setLayout(new GridBagLayout());
        
        //L'objet servant à positionner les composants
        GridBagConstraints gbc = new GridBagConstraints();
		
        //On positionne la case de départ du composant
        gbc.gridx = 0;
        gbc.gridy = 0;
        //La taille en hauteur et en largeur
        gbc.gridheight = 1;
        gbc.gridwidth = 1;
        
        //Premier graph: Reste à payer (Montant) -> LineChart
        JFreeChart lineChartAmount = ChartFactory.createLineChart(
         "Reste  à payer(Montant)",
         "Année","Montant",
         dataImportLineChart(),
         PlotOrientation.VERTICAL,
         true,true,false);

        ChartPanel pan1 = new ChartPanel(lineChartAmount, false);
        //pan1.setBounds(0, 0, 300, 300);

        pan1.addMouseMotionListener(new MouseAdapter() {
            public void mouseMoved(MouseEvent me) {
            pan1.getEntityForPoint(me.getX(), me.getY());
          }
        });
        //Fin premier graph
        
        //Deuxième graph -> Total payé(intérêt + montant + assurance)
        JFreeChart barChartGlobal = ChartFactory.createBarChart(
         "Payé (Total)",           
         "Année",            
         "Montant",            
         dataImportBarChartGlobal(),          
         PlotOrientation.VERTICAL,           
         true, true, false);
        
        ChartPanel pan2 = new ChartPanel(barChartGlobal, false);
        //pan2.setBounds(400, 350, 350, 350);
        
        pan2.addMouseMotionListener(new MouseAdapter() {
            public void mouseMoved(MouseEvent me) {
            pan2.getEntityForPoint(me.getX(), me.getY());
          }
        });
        //FIn deuxième graph
        
        //Troisième graphe -> Camembert
        JFreeChart pieChartGlobal = ChartFactory.createPieChart(      
         "Répartition",
         datasetPieChartGlobal,
         true,
         true, 
         false);

        ChartPanel pan3 = new ChartPanel(pieChartGlobal, false);
        
        pan3.addMouseMotionListener(new MouseAdapter() {
            public void mouseMoved(MouseEvent me) {
            pan3.getEntityForPoint(me.getX(), me.getY());
          }
        });
        //Fin troisième graphe
        
        pan1.setPreferredSize(new Dimension(300,250));
        pan2.setPreferredSize(new Dimension(300,250));
        pan3.setPreferredSize(new Dimension(300,250));
        
        gbc.gridx = 0;
        gbc.gridy = 0;
        pan.add(pan1,gbc);
        
        gbc.gridx = 0;
        gbc.gridy = 1;
        pan.add(pan2,gbc);
        
        gbc.gridx = 0;
        gbc.gridy = 2;
        pan.add(pan3,gbc);
        
        JButton buttonPrint = new JButton("Imprimer");
        
        gbc.gridx = 2;
        gbc.gridy = 1;
        pan.add(buttonPrint,gbc);
        //On prévient notre JFrame que notre JPanel sera son content pane
        graphFrame.setContentPane(pan);
        graphFrame.pack();
        graphFrame.setVisible(true);

        buttonPrint.addActionListener(new ActionListener()
        {
            public void actionPerformed(ActionEvent e)
            {
                PrinterJob pj = PrinterJob.getPrinterJob();
                pj.setJobName(" Print Component ");

                pj.setPrintable (new Printable() {    
                    public int print(Graphics pg, PageFormat pf, int pageNum){
                    if (pageNum > 0){
                        return Printable.NO_SUCH_PAGE;
                }

      Graphics2D g2 = (Graphics2D) pg;
      g2.translate(pf.getImageableX(), pf.getImageableY());
      pan.paint(g2);
      return Printable.PAGE_EXISTS;
    }
  });
  if (pj.printDialog() == false)
  return;

  try {
        pj.print();
  } catch (PrinterException ex) {
        // handle exception
  }
            }
        });


        //Premier graph: Reste à payer -> LineChart
        /*JFreeChart lineChart = ChartFactory.createLineChart(
         "Reste  à payer",
         "Mois","Montant",
         dataImportLineChart(),
         PlotOrientation.VERTICAL,
         true,true,false);

        ChartPanel pan1 = new ChartPanel(lineChart, false);
        pan1.setBounds(0, 350, 350, 350);

        pan1.addMouseMotionListener(new MouseAdapter() {
            public void mouseMoved(MouseEvent me) {
            pan1.getEntityForPoint(me.getX(), me.getY());
          }
        });*/
        //Fin Premier graph
        
        //Deuxième graph: Reste à payer -> BarChart
        /*JFreeChart barChart = ChartFactory.createBarChart(
         "Reste à payer",           
         "Category",            
         "Score",            
         dataImportBarChart(),          
         PlotOrientation.VERTICAL,           
         true, true, false);
        
        ChartPanel pan2 = new ChartPanel(barChart, false);
        pan2.setBounds(400, 350, 350, 350);
        
        pan2.addMouseMotionListener(new MouseAdapter() {
            public void mouseMoved(MouseEvent me) {
            pan2.getEntityForPoint(me.getX(), me.getY());
          }
        });*/
        //Fin Deuxième graph
       
        
        //this.add(pan1);
        //this.add(pan2);
        
        this.setVisible(true);
        //this.setSize(900,800);
    }//GEN-LAST:event_buttonGraphActionPerformed
    
    private DefaultCategoryDataset dataImportLineChart( )
    {
      return datasetLineChartAmount;
    }
    
    private DefaultCategoryDataset dataImportBarChartGlobal( )
    {
      return datasetBarChartGlobal;
    }
    
    private DefaultPieDataset dataImportPieChartGlobal( )
    {
      return datasetPieChartGlobal;
    }
    
    public void insertDataToLineChartAmount(double amount, int month){
        datasetLineChartAmount.addValue(amount , "Montant" , String.valueOf(month/12) );
    }
    
    public void insertDataToBarChartGlobal(double amount, String label ,int month){
        datasetBarChartGlobal.addValue(amount , label , String.valueOf(month/12) );
    }
    
    public void insertDataToPieChartGlobal(String label, double value){
        datasetPieChartGlobal.setValue(label, value);
    }
    
    public JTable getTable(){
        return amortizationTable;
    }
    
    public JLabel getLabelAMount(){
        return labelAmount;
    }
    
    public JLabel getLabelDuration(){
        return labelDuration;
    }
    
    public JLabel getLabelInsurance(){
        return labelInsurance;
    }
    
    public JLabel getLabelRate(){
        return labelRate;
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTable amortizationTable;
    private javax.swing.JButton buttonGraph;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JLabel labelAmount;
    private javax.swing.JLabel labelDuration;
    private javax.swing.JLabel labelInsurance;
    private javax.swing.JLabel labelRate;
    private javax.swing.JButton printButton;
    // End of variables declaration//GEN-END:variables


}
